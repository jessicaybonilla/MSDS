---
title: "COVID19 Practice"
author: "J.Bonilla"
date: "2025-04-14"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(stringr)
library(tidyverse)
library(lubridate)
library(glue)
```

## COVID-19 Data Analysis

This COVID-19 data is imported from the **John Hopkins University** website in four csv files. We will analyze Global cases and deaths and US cases and deaths, specifically Texas.

```{r get_johnhopkins_data}

url_in <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"
file_names <- c("time_series_covid19_confirmed_global.csv", "time_series_covid19_deaths_global.csv", "time_series_covid19_confirmed_US.csv", "time_series_covid19_deaths_US.csv")
urls <- str_c(url_in,file_names)
```
```{r import_data, echo=FALSE, message=FALSE}
#read in the four data csv
global_cases <- read_csv(urls[1])
global_deaths <- read_csv(urls[2])
US_cases <- read_csv(urls[3])
US_deaths <- read_csv(urls[4])
```

## Global Data Maximum Cases and Deaths

The Global COVID19 data was collected between January 22, 2020 through March 9, 2023.The maximum number of cases is from the United States at 103,802,702 with maximum number of deaths with 1,123,836.


```{r tidy_global_data, echo=FALSE, message=FALSE}
global_cases <- global_cases %>%
pivot_longer(cols = -c(`Province/State`,
`Country/Region`, Lat, Long),
names_to = "date",
values_to = "cases") %>%
select(-c(Lat,Long))

global_deaths <- global_deaths %>%
pivot_longer(cols = -c(`Province/State`,
`Country/Region`, Lat, Long),
names_to = "date",
values_to = "death") %>%
select(-c(Lat, Long))

global <- global_cases %>%
full_join(global_deaths) %>%
rename(Country_Region = `Country/Region`,
Province_State = `Province/State`) %>%
mutate(date = mdy(date))
global <- global %>% filter(cases > 0)

global <- global %>%
  unite("Combined_Key",
        c(Province_State, Country_Region),
        sep = ",",
        na.rm = TRUE,
        remove = FALSE)

uid_lookup_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv"
uid <- read_csv(uid_lookup_url) %>%
select(-c(Lat, Long_, Combined_Key, code3, iso2, iso3, Admin2))
global_trimmed <- global %>%
select(-Combined_Key, -Province_State,
-Country_Region)
summary(global_trimmed)

top_global_cases <- global %>%
slice_max(cases, n = 1)
global_cases_country <- top_global_cases$Country_Region
global_cases_count <- top_global_cases$cases
global_cases_date <- top_global_cases$date
glue("As of {global_cases_date}, the highest number of reported COVID-19 cases was {scales::comma(global_cases_count)} in {global_cases_country}.")


top_global_death <- global %>%
slice_max(death, n = 1)
global_death_country <- top_global_death$Country_Region
global_death_count <- top_global_death$death
global_death_date <- top_global_death$date
glue("As of {global_death_date}, the highest number of reported COVID-19 deaths was {scales::comma(global_death_count)} in {global_death_country}.")


```

## US Data Maximum Cases and Death

The US COVID19 data was collected between January 22, 2020 through March 9, 2023.The maximum number of cases is from the California at 12,129,699 with maximum number of deaths with 101,159.

```{r tidy_US_data, echo=FALSE}
US_cases <- US_cases %>%
pivot_longer(cols = -(UID:Combined_Key),
names_to = "date",
values_to = "cases") %>%
select(Admin2:cases) %>%
mutate(date = mdy(date)) %>%
select(-c(Lat, Long_))

US_deaths <- US_deaths %>%
pivot_longer(cols = -(UID:Population),
names_to = "date",
values_to = "deaths") %>%
select(Admin2:deaths) %>%
mutate(date = mdy(date)) %>%
select(-c(Lat, Long_))

US <- US_cases %>%
full_join(US_deaths)

US <- US %>% filter(cases > 0)
```
```{r US_by_state}
US_by_state <- US %>%
group_by(Province_State, Country_Region, date) %>%
summarize(cases = sum(cases), deaths = sum(deaths),
Population = sum(Population)) %>%
mutate(deaths_per_mill = deaths *1000000 / Population) %>%
select(Province_State, Country_Region, date, cases, deaths, deaths_per_mill, Population) %>%
ungroup()

US_totals <- US_by_state %>%
group_by(Country_Region, date) %>%
summarize(cases = sum(cases), deaths = sum(deaths),
Population = sum(Population)) %>%
mutate(deaths_per_mill = deaths * 1000000 / Population) %>%
select(Country_Region, date, cases, deaths, deaths_per_mill, Population) %>%
ungroup()

US_trimmed <- US_totals %>%
select(date, cases, deaths)
summary(US_trimmed)

top_US_cases <- US_by_state %>%
slice_max(cases, n = 1)
US_cases_state <- top_US_cases$Province_State
US_cases_count <- top_US_cases$cases
US_cases_date <- top_US_cases$date
glue("As of {US_cases_date}, the highest number of reported COVID-19 cases was {scales::comma(US_cases_count)} in {US_cases_state}.")

top_US_deaths <- US_by_state %>%
slice_max(deaths, n = 1)
US_deaths_state <- top_US_deaths$Province_State
US_deaths_count <- top_US_deaths$deaths
US_deaths_date <- top_US_deaths$date
glue("As of {US_deaths_date}, the highest number of reported COVID-19 deaths was {scales::comma(US_deaths_count)} in {US_deaths_state}.")


```

## Visual US Data
```{r US_visual, message=FALSE, warning=FALSE}
US_totals   %>%
filter(cases > 0) %>%
ggplot(aes(x = date, y = cases)) +
geom_line(aes(color = "cases")) +
geom_point(aes(color = "cases")) +
geom_line(aes(y = deaths, color = "deaths")) +
geom_point(aes(y = deaths, color = "deaths")) +
scale_y_log10() +
theme(legend.position="bottom",
axis.text.x = element_text(angle = 90)) +
labs(title = "COVID19 in US", y=NULL)

```
```{r TX_visual, message=FALSE, warning=FALSE}
state <- "Texas"
US_by_state %>%
filter(Province_State == state) %>%
filter(cases > 0) %>%
ggplot(aes(x = date, y = cases)) +
geom_line(aes(color = "cases")) +
geom_point(aes(color = "cases")) +
geom_line(aes(y = deaths, color = "deaths")) +
geom_point(aes(y = deaths, color = "deaths")) +
scale_y_log10() +
theme(legend.position="bottom",
axis.text.x = element_text(angle = 90)) +
labs(title = str_c("COVID19 in", state), y= NULL)

```
```{r new_US_data, message=FALSE, warning=FALSE}
US_by_state <- US_by_state %>%
mutate(new_cases = cases - lag(cases),
new_deaths = deaths - lag(deaths))
US_totals <- US_totals %>%
mutate(new_cases = cases - lag(cases),
new_deaths = deaths - lag(deaths))

US_totals   %>%
ggplot(aes(x = date, y = new_cases)) +
geom_line(aes(color = "new_cases")) +
geom_point(aes(color = "new_cases")) +
geom_line(aes(y = new_deaths, color = "new_deaths")) +
geom_point(aes(y = new_deaths, color = "new_deaths")) +
scale_y_log10() +
theme(legend.position="bottom",
axis.text.x = element_text(angle = 90)) +
labs(title = "COVID19 in US", y=NULL)

```

```{r new_TX_data, message=FALSE, warning=FALSE}
state <- "Texas"
US_by_state %>%
filter(Province_State == state) %>%
ggplot(aes(x = date, y = new_cases)) +
geom_line(aes(color = "new_cases")) +
geom_point(aes(color = "new_cases")) +
geom_line(aes(y = new_deaths, color = "new_deaths")) +
geom_point(aes(y = new_deaths, color = "new_deaths")) +
scale_y_log10() +
theme(legend.position="bottom",
axis.text.x = element_text(angle = 90)) +
labs(title = str_c("COVID19 in", state), y= NULL)

```

## US State Totals
```{r US_state_totals, message=FALSE, warning=FALSE}
US_state_totals <- US_by_state %>%
group_by(Province_State) %>%
summarize(deaths = max(deaths), cases = max(cases),
population = max(Population),
cases_per_thousand = 1000 * cases / population,
deaths_per_thousand = 1000 * deaths / population) %>%
filter(cases > 0, population > 0)

US_state_totals %>%
slice_min(deaths_per_thousand, n = 10) %>%
select(deaths_per_thousand, cases_per_thousand, everything())

US_state_totals %>%
slice_max(deaths_per_thousand, n = 10) %>%
select(deaths_per_thousand, cases_per_thousand, everything())

```
```{r linear_prediction_model, message=FALSE, warning=FALSE}
mod <- lm(deaths_per_thousand ~ cases_per_thousand, data = US_state_totals)
x_grid <- seq(100, 450)
new_df <- tibble(cases_per_thousand = x_grid)
US_state_totals %>% mutate(pred = predict(mod))
US_total_prediction <- US_state_totals %>% mutate(pred = predict(mod))
US_total_prediction %>% ggplot() +
geom_point(aes(x = cases_per_thousand, y = deaths_per_thousand), color = "blue") +
geom_point(aes(x = cases_per_thousand, y = pred), color = "red")

```

## Potential Bias

**Reporting Inconsistencies Between Countries**
Different countries have different healthcare infrastructures, testing capacities, and political motivations.

Effect: Under reporting or over reporting of cases, deaths, and recoveries. Some countries may report daily, others weekly, and some may not report at all on certain days.

**Differences in Testing Rates**
Wealthier countries tend to have more access to widespread testing, while poorer or more rural areas may test less frequently.

Effect: This can lead to underestimation of true case numbers in less-resourced regions, skewing comparisons between countries.

